# yaml-language-server: $schema=https://taskfile.dev/schema.json
version: 3

silent: true

tasks:
  # ===============
  # === ANSIBLE ===
  # ===============
  create:vm:
    desc: "Create VM on orbstack"
    dir: "{{.ORBSTACK_DIR}}"
    vars:
      ORBSTACK_DIR: '{{default "orbstack" .ORBSTACK_DIR}}'
      DISTRO: '{{default "ubuntu:jammy" .DISTRO}}'
    cmds:
      - echo ""
      - echo "ðŸš€ create:vm [ VM_NAME - {{.VM_NAME}}, ORBSTACK_DIR - {{.ORBSTACK_DIR}}, DISTRO - {{.DISTRO}}"
      - 'echo "   cwd: $(pwd)"'
      - echo ""
      - orb create --arch amd64 -c {{.ORBSTACK_DIR}}/user-data.yml {{.DISTRO}} {{.VM_NAME}}
    requires:
      vars: [VM_NAME]

  stop:vm:
    desc: "Stop VM on orbstack"
    cmds:
      - echo ""
      - echo "ðŸš€ stop:vm [ VM_NAME - {{.VM_NAME}}"
      - 'echo "   cwd: $(pwd)"'
      - echo ""
      - cmd: orb stop {{.VM_NAME}}
        ignore_error: true
    requires:
      vars: [VM_NAME]

  delete:vm:
    desc: "Delete VM on orbstack"
    cmds:
      - echo ""
      - echo "ðŸš€ delete:vm [ VM_NAME - {{.VM_NAME}}"
      - 'echo "   cwd: $(pwd)"'
      - echo ""
      - cmd: orb delete -f {{.VM_NAME}}
        ignore_error: true
    requires:
      vars: [VM_NAME]
