# yaml-language-server: $schema=https://taskfile.dev/schema.json
version: 3

silent: true

tasks:
  connectivity:test:
    desc: "Test SSH connectivity"
    vars:
      HOST_IP:
        sh: cd 1-terraform/environment/{{.STAGE}} && terraform output -raw vm_public_ipv4
      COMMAND: ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -i ~/.ssh/id_rsa -p 22 ubuntu@{{.HOST_IP}} "date"
    cmds:
      - echo ""
      - echo "ðŸš€ tasks-ssh - {{.TAKS}} [ HOST_IP - {{.HOST_IP}} ]"
      - 'echo "   cwd: $(pwd)"'
      - echo ""
      - echo {{.COMMAND}}
      - "{{.COMMAND}}"
    requires:
      vars: [STAGE]

  connect:
    desc: "SSH connect"
    vars:
      HOST_IP:
        sh: cd 1-terraform/environment/{{.STAGE}} && terraform output -raw vm_public_ipv4
      COMMAND: ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -i ~/.ssh/id_rsa -p 22 ubuntu@{{.HOST_IP}}
    cmds:
      - echo ""
      - echo "ðŸš€ tasks-ssh - {{.TAKS}} [ HOST_IP - {{.HOST_IP}} ]"
      - 'echo "   cwd: $(pwd)"'
      - echo ""
      - echo {{.COMMAND}}
      - "{{.COMMAND}}"
    requires:
      vars: [STAGE]
